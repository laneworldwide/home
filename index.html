<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Player</title>
    <style>
        /* Styles for the clickable image */
        #clickable-image {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: transform 0.5s ease;
        }
        /* Styles for the Spotify player container */
        #spotify-player {
            display: none; /* Initially hidden */
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 80px; /* Adjust the height as needed */
            background: #333; /* Example background color */
        }
    </style>
</head>
<body>
    <!-- Container for the clickable image -->
    <img src="static/clickable-image.png" id="clickable-image" alt="Clickable Image" width="100" height="100">

    <!-- Placeholder for Spotify's SDK -->
    <div id="spotify-player"></div>

    <!-- Load the Spotify Web Playback SDK -->
    <script src="https://sdk.scdn.co/spotify-player.js"></script>

    <!-- Define onSpotifyWebPlaybackSDKReady function -->
    <script>
        window.onSpotifyWebPlaybackSDKReady = () => {
            console.log('Spotify Web Playback SDK is ready');
            const token = 'BQDbV-0XT6gn3SzPNv7iPKYbUW5sJqM16b_yDSBt1Yrmb_hFdubZMdvXWbYWPHJimGW347-bzlX8XOBzUgSos248vME6ok3OP32OkW7q4PHZPinsNfPfvwjUD8bm1PPabBnTyDOtNa7w7nERl_cvpNyXvJ22FoXpvYfTPK1QMsNc_Zn3kSteO6nuEpC85rKtTsaJfOywUg'; // Replace with your actual token
            const player = new Spotify.Player({
                name: 'Unique Spotify Web Playback Player',
                getOAuthToken: cb => { cb(token); },
                volume: 0.5
            });

            // Error handling
            player.addListener('initialization_error', ({ message }) => { console.error('Initialization error:', message); });
            player.addListener('authentication_error', ({ message }) => { console.error('Authentication error:', message); });
            player.addListener('account_error', ({ message }) => { console.error('Account error:', message); });
            player.addListener('playback_error', ({ message }) => { console.error('Playback error:', message); });

            // Ready
            player.addListener('ready', ({ device_id }) => {
                console.log('Ready with Device ID', device_id);
                transferPlaybackHere(device_id, token);
            });

            // Not Ready
            player.addListener('not_ready', ({ device_id }) => {
                console.log('Device ID has gone offline', device_id);
            });

            // Connect to the player!
            player.connect();

            // Function to transfer playback to this player
            function transferPlaybackHere(device_id, token) {
                fetch('https://api.spotify.com/v1/me/player', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        "device_ids": [device_id],
                        "play": true,
                    }),
                }).then(response => {
                    if (response.ok) {
                        console.log('Playback transferred');
                    } else {
                        console.error('Failed to transfer playback', response.statusText);
                    }
                }).catch(error => {
                    console.error('Error in fetch request:', error);
                });
            }

            // Listen for playback status changes
            player.addListener('player_state_changed', state => {
                if (!state) {
                    return;
                }

                const isPlaying = !state.paused;
                if (isPlaying) {
                    triggerEffects();
                } else {
                    stopEffects();
                }
            });

            // Function to trigger visual effects
            function triggerEffects() {
                // Strobe effect
                const body = document.body;
                let strobeInterval = setInterval(() => {
                    body.style.backgroundColor = body.style.backgroundColor === 'white' ? 'black' : 'white';
                }, 100); // Adjust for strobe speed

                // Moving image
                const clickableImage = document.getElementById('clickable-image');
                let moveInterval = setInterval(() => {
                    const x = Math.random() * (window.innerWidth - clickableImage.clientWidth);
                    const y = Math.random() * (window.innerHeight - clickableImage.clientHeight);
                    clickableImage.style.transform = `translate(${x}px, ${y}px)`;
                }, 500); // Adjust for movement speed

                // Store intervals so they can be cleared later
                window.currentEffects = { strobeInterval, moveInterval };
            }

            // Function to stop visual effects
            function stopEffects() {
                const { strobeInterval, moveInterval } = window.currentEffects || {};
                if (strobeInterval) clearInterval(strobeInterval);
                if (moveInterval) clearInterval(moveInterval);
                document.body.style.backgroundColor = ''; // Reset background

                // Optionally reset image position
                const clickableImage = document.getElementById('clickable-image');
                clickableImage.style.transform = `translate(-50%, -50%)`;
            }
        };
    </script>
    
    <!-- Initialize player on image click -->
    <script>
        document.getElementById('clickable-image').addEventListener('click', () => {
            console.log('Clickable image clicked');
            document.getElementById('spotify-player').style.display = 'block'; // Show the player container
            if (window.onSpotifyWebPlaybackSDKReady) {
                window.onSpotifyWebPlaybackSDKReady(); // Initialize the player
            } else {
                console.error('Spotify Web Playback SDK is not ready.');
            }
        });
    </script>
</body>
</html>


